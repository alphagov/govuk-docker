version: '3.7'

volumes:
  home:
  rabbitmq:
  postgres:
  mysql:
  mongo:
  go:
  elasticsearch6:

services:
  postgres:
    image: postgres:9.6
    volumes:
      - postgres:/var/lib/postgresql/data
    ports:
      - 5432:5432

  memcached:
    image: memcached

  mongo:
    image: mongo:2.4
    volumes:
      - mongo:/data/db
    ports:
      - "27017:27017"
      - "28017:28017"

  mysql:
    image: mysql:5.5.58
    volumes:
      - mysql:/var/lib/mysql
    command: --max_allowed_packet=1073741824
    environment:
      MYSQL_ROOT_PASSWORD: root

  redis:
    image: redis

  rabbitmq:
    image: rabbitmq
    volumes:
      - rabbitmq:/var/lib/rabbitmq

  elasticsearch6:
    image: elasticsearch:6.7.0
    environment:
      - http.host=0.0.0.0
      - transport.host=127.0.0.1
      - xpack.security.enabled=false
      - ES_JAVA_OPTS=-Xms512m -Xmx512m
    volumes:
      - elasticsearch6:/usr/share/elasticsearch/data

  nginx-proxy:
    image: jwilder/nginx-proxy:latest
    ports:
      - "80:80"
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock
      - ./nginx-proxy.conf:/etc/nginx/proxy.conf
    networks:
      default:
        aliases:
          - asset-manager.dev.gov.uk
          - authenticating-proxy.dev.gov.uk
          - calculators.dev.gov.uk
          - calendars.dev.gov.uk
          - collections-publisher.dev.gov.uk
          - collections.dev.gov.uk
          - content-publisher.dev.gov.uk
          - content-store.dev.gov.uk
          - content-tagger.dev.gov.uk
          - draft-calculators.dev.gov.uk
          - draft-calendars.dev.gov.uk
          - draft-collections.dev.gov.uk
          - draft-content-store.dev.gov.uk
          - draft-frontend.dev.gov.uk
          - draft-government-frontend.dev.gov.uk
          - draft-manuals-frontend.dev.gov.uk
          - draft-origin.dev.gov.uk
          - draft-router-api.dev.gov.uk
          - draft-router.dev.gov.uk
          - draft-service-manual-frontend.dev.gov.uk
          - draft-static.dev.gov.uk
          - email-alert-api.dev.gov.uk
          - email-alert-frontend.dev.gov.uk
          - frontend.dev.gov.uk
          - finder-frontend.dev.gov.uk
          - government-frontend.dev.gov.uk
          - govuk-developer-docs.dev.gov.uk
          - govuk-publishing-components.dev.gov.uk
          - info-frontend.dev.gov.uk
          - licence-finder.dev.gov.uk
          - link-checker-api.dev.gov.uk
          - manuals-frontend.dev.gov.uk
          - mapit.dev.gov.uk
          - publisher.dev.gov.uk
          - publishing-api.dev.gov.uk
          - release.dev.gov.uk
          - router-api.dev.gov.uk
          - router.dev.gov.uk
          - search-admin.dev.gov.uk
          - search-api.dev.gov.uk
          - search.dev.gov.uk
          - service-manual-frontend.dev.gov.uk
          - short-url-manager.dev.gov.uk
          - signon.dev.gov.uk
          - smart-answers.dev.gov.uk
          - specialist-publisher.dev.gov.uk
          - static.dev.gov.uk
          - support-api.dev.gov.uk
          - support.dev.gov.uk
          - transition.dev.gov.uk
          - travel-advice-publisher.dev.gov.uk
          - whitehall-admin.dev.gov.uk
          - www-origin.dev.gov.uk
          - www.dev.gov.uk
